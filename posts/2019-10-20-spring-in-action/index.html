<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Shareif">
    <meta name="description" content="Tech Notes">
    <meta name="keywords" content="blog,developer,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="spring æ¼«æ¸¸"/>
<meta name="twitter:description" content="Table of Contents generated with DocToc
 spring-boot-autoconfiguration  Condition Jackson Mongo Quartz *[to do]* Kafka Redis  è¿è¡ŒåŸºäºDockerçš„Redis WHY ?     Spring Integration  æ¦‚è§ˆ    spring-boot-autoconfiguration Condition AutoConfigurationçš„conditionåŒ…ä¸‹é¢æœ‰ä¸€å¥—æ¡ä»¶æ³¨è§£ï¼Œç”¨æ¥å†³å®šä»€ä¹ˆæ—¶å€™åˆ›å»ºbeanï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»éƒ½ä¼šç”¨åˆ°é‡Œé¢çš„æ³¨è§£æ¥â€œæ™ºèƒ½â€çš„å†³å®šä»€ä¹ˆæ—¶å€™åˆ›å»ºbeanã€‚
   æ³¨è§£ è§£é‡Š     @ConditionalOnBean å½“BeanFactoryä¸­å­˜åœ¨æŸä¸ªbeanæ—¶æ»¡è¶³æ¡ä»¶ï¼Œå¯ä»¥åŒ¹é…å¤šä¸ª   @ConditionalOnClass å½“ClassPathä¸‹å­˜åœ¨æŸä¸ªç±»æ—¶æ»¡è¶³æ¡ä»¶ï¼Œå¯ä»¥åŒ¹é…å¤šä¸ª   @ConditionalOnCloudPlatform å·´æ‹‰å·´æ‹‰   @ConditionalOnExpression å¯ä»¥å®šä¹‰SpELè¯­å¥è¿›è¡ŒåŒ¹é…   @ConditinalOnJava åŒ¹é…å½“å‰è¿è¡ŒJVMç‰ˆæœ¬   @ConditionalOnJndi    @ConditionalOnMissingBean    @ConditionalOnMissingClass    @ConditinalOnNotWebApplication    @ConditionalOnProperty å½“æ»¡è¶³æŸä¸ªå±æ€§æ—¶æ»¡è¶³æ¡ä»¶   @ConditionalOnResource å½“classpathä¸‹å­˜åœ¨æŸä¸ªèµ„æºæ–‡ä»¶æ—¶æ»¡è¶³æ¡ä»¶ï¼Œå¯ä»¥åŒ¹é…å¤šä¸ª   @ConditinalOnSingleCandidate    @ConditinalOnWebApplication     ä¸¾å‡ ä¸ªğŸŒ°ï¼š"/>

    <meta property="og:title" content="spring æ¼«æ¸¸" />
<meta property="og:description" content="Table of Contents generated with DocToc
 spring-boot-autoconfiguration  Condition Jackson Mongo Quartz *[to do]* Kafka Redis  è¿è¡ŒåŸºäºDockerçš„Redis WHY ?     Spring Integration  æ¦‚è§ˆ    spring-boot-autoconfiguration Condition AutoConfigurationçš„conditionåŒ…ä¸‹é¢æœ‰ä¸€å¥—æ¡ä»¶æ³¨è§£ï¼Œç”¨æ¥å†³å®šä»€ä¹ˆæ—¶å€™åˆ›å»ºbeanï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»éƒ½ä¼šç”¨åˆ°é‡Œé¢çš„æ³¨è§£æ¥â€œæ™ºèƒ½â€çš„å†³å®šä»€ä¹ˆæ—¶å€™åˆ›å»ºbeanã€‚
   æ³¨è§£ è§£é‡Š     @ConditionalOnBean å½“BeanFactoryä¸­å­˜åœ¨æŸä¸ªbeanæ—¶æ»¡è¶³æ¡ä»¶ï¼Œå¯ä»¥åŒ¹é…å¤šä¸ª   @ConditionalOnClass å½“ClassPathä¸‹å­˜åœ¨æŸä¸ªç±»æ—¶æ»¡è¶³æ¡ä»¶ï¼Œå¯ä»¥åŒ¹é…å¤šä¸ª   @ConditionalOnCloudPlatform å·´æ‹‰å·´æ‹‰   @ConditionalOnExpression å¯ä»¥å®šä¹‰SpELè¯­å¥è¿›è¡ŒåŒ¹é…   @ConditinalOnJava åŒ¹é…å½“å‰è¿è¡ŒJVMç‰ˆæœ¬   @ConditionalOnJndi    @ConditionalOnMissingBean    @ConditionalOnMissingClass    @ConditinalOnNotWebApplication    @ConditionalOnProperty å½“æ»¡è¶³æŸä¸ªå±æ€§æ—¶æ»¡è¶³æ¡ä»¶   @ConditionalOnResource å½“classpathä¸‹å­˜åœ¨æŸä¸ªèµ„æºæ–‡ä»¶æ—¶æ»¡è¶³æ¡ä»¶ï¼Œå¯ä»¥åŒ¹é…å¤šä¸ª   @ConditinalOnSingleCandidate    @ConditinalOnWebApplication     ä¸¾å‡ ä¸ªğŸŒ°ï¼š" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.shareif.cn/posts/2019-10-20-spring-in-action/" />
<meta property="article:published_time" content="2019-10-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-10-20T00:00:00+00:00" />


    
      <base href="https://www.shareif.cn/posts/2019-10-20-spring-in-action/">
    
    <title>
  spring æ¼«æ¸¸ Â· Shareif
</title>

    
      <link rel="canonical" href="https://www.shareif.cn/posts/2019-10-20-spring-in-action/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://www.shareif.cn/css/coder.min.f836d178c998732a4e8b7e49798325e194b50b4149203e005dfe464c83c20051.css" integrity="sha256-&#43;DbReMmYcypOi35JeYMl4ZS1C0FJID4AXf5GTIPCAFE=" crossorigin="anonymous" media="screen" />
    

    

    

    

    

    

    <link rel="icon" type="image/png" href="https://www.shareif.cn/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://www.shareif.cn/images/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.63.2" />
  </head>

  
  
  <body class="colorscheme-light">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://www.shareif.cn/">
      Shareif
    </a>
    
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.shareif.cn/posts/">Blog</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.shareif.cn/about/">About</a>
          </li>
        
      
      
    </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">spring æ¼«æ¸¸</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2019-10-20T00:00:00Z'>
                2019-10-20
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              5-minute read
            </span>
          </div>
          
          
        </div>
      </header>

      <div>
        
        <!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc">DocToc</a></em></p>
<ul>
<li><a href="#spring-boot-autoconfiguration">spring-boot-autoconfiguration</a>
<ul>
<li><a href="#condition">Condition</a></li>
<li><a href="#jackson">Jackson</a></li>
<li><a href="#mongo">Mongo</a></li>
<li><a href="#quartz-to-do">Quartz *[to do]*</a></li>
<li><a href="#kafka">Kafka</a></li>
<li><a href="#redis">Redis</a>
<ul>
<li><a href="#%E8%BF%90%E8%A1%8C%E5%9F%BA%E4%BA%8Edocker%E7%9A%84redis">è¿è¡ŒåŸºäºDockerçš„Redis</a></li>
<li><a href="#why-">WHY ?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#spring-integration">Spring Integration</a>
<ul>
<li><a href="#%E6%A6%82%E8%A7%88">æ¦‚è§ˆ</a></li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<h2 id="spring-boot-autoconfiguration">spring-boot-autoconfiguration</h2>
<h3 id="condition">Condition</h3>
<p>AutoConfigurationçš„conditionåŒ…ä¸‹é¢æœ‰ä¸€å¥—æ¡ä»¶æ³¨è§£ï¼Œç”¨æ¥å†³å®šä»€ä¹ˆæ—¶å€™åˆ›å»ºbeanï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»éƒ½ä¼šç”¨åˆ°é‡Œé¢çš„æ³¨è§£æ¥â€œæ™ºèƒ½â€çš„å†³å®šä»€ä¹ˆæ—¶å€™åˆ›å»ºbeanã€‚</p>
<table>
<thead>
<tr>
<th>æ³¨è§£</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@ConditionalOnBean</code></td>
<td>å½“BeanFactoryä¸­å­˜åœ¨æŸä¸ªbeanæ—¶æ»¡è¶³æ¡ä»¶ï¼Œå¯ä»¥åŒ¹é…å¤šä¸ª</td>
</tr>
<tr>
<td><code>@ConditionalOnClass</code></td>
<td>å½“ClassPathä¸‹å­˜åœ¨æŸä¸ªç±»æ—¶æ»¡è¶³æ¡ä»¶ï¼Œå¯ä»¥åŒ¹é…å¤šä¸ª</td>
</tr>
<tr>
<td><code>@ConditionalOnCloudPlatform</code></td>
<td>å·´æ‹‰å·´æ‹‰</td>
</tr>
<tr>
<td><code>@ConditionalOnExpression</code></td>
<td>å¯ä»¥å®šä¹‰SpELè¯­å¥è¿›è¡ŒåŒ¹é…</td>
</tr>
<tr>
<td><code>@ConditinalOnJava</code></td>
<td>åŒ¹é…å½“å‰è¿è¡ŒJVMç‰ˆæœ¬</td>
</tr>
<tr>
<td><code>@ConditionalOnJndi</code></td>
<td></td>
</tr>
<tr>
<td><code>@ConditionalOnMissingBean</code></td>
<td></td>
</tr>
<tr>
<td><code>@ConditionalOnMissingClass</code></td>
<td></td>
</tr>
<tr>
<td><code>@ConditinalOnNotWebApplication</code></td>
<td></td>
</tr>
<tr>
<td><code>@ConditionalOnProperty</code></td>
<td>å½“æ»¡è¶³æŸä¸ªå±æ€§æ—¶æ»¡è¶³æ¡ä»¶</td>
</tr>
<tr>
<td><code>@ConditionalOnResource</code></td>
<td>å½“classpathä¸‹å­˜åœ¨æŸä¸ªèµ„æºæ–‡ä»¶æ—¶æ»¡è¶³æ¡ä»¶ï¼Œå¯ä»¥åŒ¹é…å¤šä¸ª</td>
</tr>
<tr>
<td><code>@ConditinalOnSingleCandidate</code></td>
<td></td>
</tr>
<tr>
<td><code>@ConditinalOnWebApplication</code></td>
<td></td>
</tr>
</tbody>
</table>
<p>ä¸¾å‡ ä¸ªğŸŒ°ï¼š</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Configuration
@ConditionalOnProperty(prefix = <span style="font-style:italic">&#34;cn.shareif.auth&#34;</span>, value = <span style="font-style:italic">&#34;enabled&#34;</span>, matchIfMissing = <span style="font-weight:bold">true</span>)
<span style="font-weight:bold">public</span> <span style="font-weight:bold">class</span> <span style="font-weight:bold">ShareifAuthAutoConfiguration</span> {

    @Bean
    <span style="font-weight:bold">public</span> FilterRegistrationBean filterRegistrationBean() {
        FilterRegistrationBean bean = <span style="font-weight:bold">new</span> FilterRegistrationBean();
        bean.setFilter(<span style="font-weight:bold">new</span> AuthFilter());
        bean.addUrlPatterns(<span style="font-style:italic">&#34;/*&#34;</span>);
        <span style="font-weight:bold">return</span> bean;
    }
}
</code></pre></div><p>è®¾ç½®Webæ‹¦æˆªå™¨ï¼Œå½“ç„¶è®¾ç½®æ‹¦æˆªå™¨æœ‰æ›´ç®€å•çš„æ–¹æ³•ï¼Œæ¯”å¦‚<code>@WebFilter</code>æ³¨è§£ï¼Œæ­¤å¤„ä»…ä»…æ˜¯ä¸¾ä¸€ä¸ª<code>@ConditinalOnProperty</code>çš„æ —å­ã€‚å½“é¡¹ç›®çš„é…ç½®æ–‡ä»¶ä¸­ï¼ˆæ¯”å¦‚ application.propertiesï¼‰å®šä¹‰äº†<code>cn.shareif.auth.enabled=true</code> æ—¶ï¼Œå°±ä¼šè§¦å‘è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ï¼Œå¦‚æœæ²¡æœ‰é…ç½®å±æ€§ï¼Œé»˜è®¤è‡ªåŠ¨è§¦å‘ã€‚</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Slf4j
@Configuration
@ConditionalOnResource(resources = <span style="font-style:italic">&#34;classpath:lib/certificate.so&#34;</span>)
<span style="font-weight:bold">public</span> <span style="font-weight:bold">class</span> <span style="font-weight:bold">LibResourceAutoConfiguration</span> {

    @Bean
    <span style="font-weight:bold">public</span> CertificateHelper load() {
        <span style="font-style:italic">// load from resources and return a helper bean consist of this resource.
</span><span style="font-style:italic"></span>        log.info(<span style="font-style:italic">&#34;Oh, you have loaded the resource&#34;</span>);
        <span style="font-weight:bold">return</span> <span style="font-weight:bold">new</span> CertificateHelper();
    }
}
</code></pre></div><p>å½“classpathä¸­å­˜åœ¨æŸä¸ªèµ„æºæ–‡ä»¶æ—¶ï¼Œè¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚</p>
<h3 id="jackson">Jackson</h3>
<p>æ— èµ·æ­¥ä¾èµ–ã€‚</p>
<p>Springbooté»˜è®¤çš„Jsonå®ç°æ˜¯Jacksonï¼Œå…¶å¯¹åº”çš„è‡ªåŠ¨é…ç½®ç±»ä¸º<code>JacksonAutoConfiguration</code>ï¼ŒåŒæ—¶é€šè¿‡<code>JacksonHttpMessageConvertersConfiguration</code> é…ç½®HttpMessageConverterå®ç°ç±»ç”¨äºHttpè¯·æ±‚ä¸­Jsonåˆ°Javaå¯¹è±¡æˆ–è€…Javaå¯¹è±¡åˆ°Jsonçš„è½¬æ¢ã€‚</p>
<p>JacksonAutoConfigurationçš„è§¦å‘æ¡ä»¶ä¸ºå­˜åœ¨ç±»ï¼š<code>com.fasterxml.jackson.databind.ObjectMapper.class</code>ã€‚æ­¤é…ç½®å°†æä¾›ä¸€äº›åŸºç¡€beanï¼Œæ¯”å¦‚<code>ObjectMapper</code> beanï¼Œ<code>JsonComponentModule</code> beanã€‚<code>ObjectMapper</code> beanæ˜¯POJOå’ŒStringè½¬æ¢çš„å…³é”®è§’è‰²ï¼Œè€Œ<code>JsonComponentModule</code> beanæ˜¯é…ç½®ç”±<code>@JsonComponent</code>å®šä¹‰çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç»„ä»¶çš„å…³é”®è§’è‰²ã€‚æ‘˜å–æºç ä¸­å¯¹<code>@JsonComponent</code>çš„æ³¨é‡Šï¼ˆRedisç« èŠ‚æœ‰å®é™…åº”ç”¨ï¼‰ï¼š</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="font-style:italic">/**
</span><span style="font-style:italic"> * {@link Component} that provides {@link JsonSerializer} and/or {@link JsonDeserializer}
</span><span style="font-style:italic"> * implementations to be registered with Jackson when {@link JsonComponentModule} is in
</span><span style="font-style:italic"> * use. Can be used to annotate {@link JsonSerializer} or {@link JsonDeserializer}
</span><span style="font-style:italic"> * implementations directly or a class that contains them as inner-classes. For example:
</span><span style="font-style:italic"> * 
</span><span style="font-style:italic"> * ç”¨æ³•ä¸¾ä¾‹ï¼š
</span><span style="font-style:italic"> * @JsonComponent
</span><span style="font-style:italic"> * public class CustomerJsonComponent {
</span><span style="font-style:italic"> *
</span><span style="font-style:italic"> *     public static class SomeDTOSerializer extends JsonSerializer&lt;Customer&gt; {
</span><span style="font-style:italic"> *         // ...
</span><span style="font-style:italic"> *     }
</span><span style="font-style:italic"> *
</span><span style="font-style:italic"> *     public static class SomeDTODeserializer extends JsonDeserializer&lt;Customer&gt; {
</span><span style="font-style:italic"> *         // ...
</span><span style="font-style:italic"> *     }
</span><span style="font-style:italic"> *
</span><span style="font-style:italic"> * }
</span><span style="font-style:italic"> *
</span><span style="font-style:italic"> */</span>
</code></pre></div><p>JacksonHttpMessageConvertersConfigurationé…ç½®ç±»å¯ä»¥æä¾›ä¸¤ä¸ªbeanï¼Œä¸€ä¸ªä¸º<code>MappingJackson2HttpMessageConverter</code>ï¼Œå¦ä¸€ä¸ªä¸º<code>MappingJackson2XmlHttpMessageConverter</code> ã€‚å‰è€…è§£æåª’ä½“ç±»å‹ä¸º<code>application/json</code>çš„æ•°æ®ï¼Œåè€…è§£æ<code>application/xml</code>çš„æ•°æ®ã€‚</p>
<p><code>MappingJackson2HttpMessageConverter</code>å®ç°äº†å…³é”®æ¥å£<code>GenericHttpMessageConverter</code> ç”¨äºå°†httpè¯·æ±‚è½¬æ¢ä¸ºæŒ‡å®šæ³›å‹ç±»å‹çš„ç›®æ ‡å¯¹è±¡ï¼Œå°†æŒ‡å®šæ³›å‹ç±»å‹çš„æºå¯¹è±¡è½¬æ¢ä¸ºhttpå“åº”ã€‚</p>
<p>æ€»ç»“ï¼Œåœ¨Springbootå¯åŠ¨åï¼Œå°±å·²ç»è‡ªåŠ¨é…ç½®äº†ä¸€ç³»åˆ—çš„beanæ¥æ”¯æŒJsonå’ŒJavaå¯¹è±¡çš„è½¬åŒ–ï¼Œå¦‚æœè¿½æ±‚æ€§èƒ½ï¼Œå®Œå…¨ä¸ç”¨è‡ªå·±å†newä¸€ä¸ªObjectMapperç”šè‡³å¤šä¸ªObjectMapperï¼Œ<code>ObjectMapper</code>æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥æ”¾å¿ƒå¤§èƒ†çš„ç”¨å•ä¾‹æ¨¡å¼ã€‚åŒæ—¶ç”±äºæ³¨è§£<code>@JsonComponent</code> å’Œbean <code>JsonComponentModule</code> ,å¯ä»¥éå¸¸æ–¹ä¾¿çš„è‡ªå®šä¹‰æŸäº›ç±»å‹çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ–¹æ³•ã€‚æ‰€ä»¥ä¸€ä¸ªé¡¹ç›®é‡Œé¢æœ‰å¤šä¸ª<code>ObjectMapper</code>æ˜¯æ— æ„ä¹‰çš„ã€‚ä¸€ä¸ªé¡¹ç›®é‡Œæœ‰ä¸€ä¸ªjsonå®ç°åº“å°±å¤Ÿäº†ï¼Œè€Œä¸”Springbootå®Œå…¨å¯ä»¥é’ˆå¯¹ä¸åŒçš„jsonåº“è¿›è¡Œè‡ªåŠ¨é…ç½®ï¼Œæ¯”å¦‚gsonã€‚ä»å¾®æœåŠ¡ä¾èµ–çš„è§’åº¦ä»¥åŠåºåˆ—åŒ–ååºåˆ—åŒ–åŠ¨ä½œä¸€è‡´æ€§çš„è§’åº¦æ¥è®²ï¼Œæœ€å¥½ä¸è¦å¼•å…¥å¤šä¸ªObjectMapperæˆ–è€…å¤šä¸ªjsonåº“ã€‚</p>
<p>é™„ï¼šå¦‚ä½•ç”¨Springbootçš„è‡ªå·±åˆ›å»ºçš„<code>ObjectMapper</code></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Component
<span style="font-weight:bold">public</span> <span style="font-weight:bold">class</span> <span style="font-weight:bold">SpringUtil</span> <span style="font-weight:bold">implements</span> BeanFactoryAware {

    <span style="font-weight:bold">private</span> <span style="font-weight:bold">static</span> BeanFactory beanFactory;

    @Override
    <span style="font-weight:bold">public</span> <span style="">void</span> setBeanFactory(BeanFactory beanFactory) <span style="font-weight:bold">throws</span> BeansException {
        SpringUtil.beanFactory = beanFactory;
    }

    <span style="font-weight:bold">public</span> <span style="font-weight:bold">static</span> Object getBean(String beanName){
        <span style="font-weight:bold">return</span> beanFactory.getBean(beanName);
    }

    <span style="font-weight:bold">public</span> <span style="font-weight:bold">static</span> Object getBean(Class&lt;?&gt; clazz) {
        <span style="font-weight:bold">return</span> beanFactory.getBean(clazz);
    }
}
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Slf4j
<span style="font-weight:bold">public</span> <span style="font-weight:bold">class</span> <span style="font-weight:bold">JacksonUtil</span> {
    <span style="font-weight:bold">private</span> <span style="font-weight:bold">static</span> <span style="font-weight:bold">final</span> ObjectMapper objectMapper;

    <span style="font-weight:bold">static</span> {
        objectMapper = SpringUtil.getBean(ObjectMapper.class);
    }

    <span style="font-weight:bold">public</span> <span style="font-weight:bold">static</span> String toJson(Object obj) {
        Assert.notNull(obj, <span style="font-style:italic">&#34;Object must not be null&#34;</span>);
        <span style="font-weight:bold">try</span> {
            <span style="font-weight:bold">return</span> objectMapper.writeValueAsString(obj);
        } <span style="font-weight:bold">catch</span> (Exception e) {
            log.error(<span style="font-style:italic">&#34;convert to string failed, {}&#34;</span>, e.getStackTrace());
            <span style="font-weight:bold">return</span> <span style="font-weight:bold">null</span>;
        }
    }

    <span style="font-weight:bold">public</span> <span style="font-weight:bold">static</span> &lt;T&gt; T fromJson(String json, Class&lt;T&gt; clazz) {
        Assert.notNull(json, <span style="font-style:italic">&#34;json string must not be null&#34;</span>);
        Assert.notNull(clazz, <span style="font-style:italic">&#34;Class Type must not be null&#34;</span>);

        <span style="font-weight:bold">try</span> {
            <span style="font-weight:bold">return</span> objectMapper.readValue(json, clazz);
        } <span style="font-weight:bold">catch</span> (Exception e) {
            log.error(<span style="font-style:italic">&#34;convert to obj failed, {}&#34;</span>, e.getStackTrace());
            <span style="font-weight:bold">return</span> <span style="font-weight:bold">null</span>;
        }
    }
}
</code></pre></div><p>å½“ç„¶ä¸ç”¨é™æ€æ–¹æ³•çš„å½¢å¼æš´éœ²åŠŸèƒ½ï¼Œè€Œç›´æ¥åœ¨beané‡Œautowiredä¹Ÿæ˜¯å¯ä»¥æ»´ã€‚</p>
<blockquote>
<p>References:</p>
<ol>
<li><a href="https://www.baeldung.com/spring-boot-jsoncomponent">https://www.baeldung.com/spring-boot-jsoncomponent</a></li>
</ol>
</blockquote>
<h3 id="mongo">Mongo</h3>
<p>æœ‰ä¸¤ç§Mongoè‡ªåŠ¨é…ç½®ç±»ï¼Œä¸€ç§æ˜¯è¿æ¥çœŸå®çš„mongoé…ç½®ï¼Œä¸€ç§æ˜¯å†…å­˜å¼çš„mongoé…ç½®ã€‚é…ç½®é¡ºåºä¸ºå…ˆé…ç½®å†…å­˜å¼mongoï¼ˆå¦‚æœæ¡ä»¶æ»¡è¶³ï¼‰ï¼Œå†é…ç½®çœŸå®mongoã€‚</p>
<ol>
<li>
<p>å†…å­˜å¼mongoè‡ªåŠ¨é…ç½®ä¾èµ–ï¼š</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="font-style:italic">&lt;!--</span><span style="font-style:italic"> https://mvnrepository.com/artifact/de.flapdoodle.embed/de.flapdoodle.embed.mongo </span><span style="font-style:italic">--&gt;</span>
<span style="font-weight:bold">&lt;dependency</span><span style="font-weight:bold">&gt;</span>
    <span style="font-weight:bold">&lt;groupId</span><span style="font-weight:bold">&gt;</span>de.flapdoodle.embed<span style="font-weight:bold">&lt;/groupId&gt;</span>
    <span style="font-weight:bold">&lt;artifactId</span><span style="font-weight:bold">&gt;</span>de.flapdoodle.embed.mongo<span style="font-weight:bold">&lt;/artifactId&gt;</span>
    <span style="font-weight:bold">&lt;version</span><span style="font-weight:bold">&gt;</span>x.x.x<span style="font-weight:bold">&lt;/version&gt;</span>
    <span style="font-weight:bold">&lt;scope</span><span style="font-weight:bold">&gt;</span>test<span style="font-weight:bold">&lt;/scope&gt;</span>
<span style="font-weight:bold">&lt;/dependency&gt;</span>
   
<span style="font-style:italic">&lt;!--</span><span style="font-style:italic"> https://mvnrepository.com/artifact/org.springframework.boot/spring</span><span style="font-style:italic">-</span><span style="font-style:italic">boot</span><span style="font-style:italic">-</span><span style="font-style:italic">starter</span><span style="font-style:italic">-</span><span style="font-style:italic">data</span><span style="font-style:italic">-</span><span style="font-style:italic">mongodb </span><span style="font-style:italic">--&gt;</span>
<span style="font-weight:bold">&lt;dependency</span><span style="font-weight:bold">&gt;</span>
    <span style="font-weight:bold">&lt;groupId</span><span style="font-weight:bold">&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
    <span style="font-weight:bold">&lt;artifactId</span><span style="font-weight:bold">&gt;</span>spring-boot-starter-data-mongodb<span style="font-weight:bold">&lt;/artifactId&gt;</span>
    <span style="font-weight:bold">&lt;version</span><span style="font-weight:bold">&gt;</span>x.x.x.RELEASE<span style="font-weight:bold">&lt;/version&gt;</span>
<span style="font-weight:bold">&lt;/dependency&gt;</span>
</code></pre></div></li>
<li>
<p>çœŸå®mongoé…ç½®å¯ä»¥ç›´æ¥ä¾èµ–ï¼š</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="font-style:italic">&lt;!--</span><span style="font-style:italic"> https://mvnrepository.com/artifact/org.springframework.boot/spring</span><span style="font-style:italic">-</span><span style="font-style:italic">boot</span><span style="font-style:italic">-</span><span style="font-style:italic">starter</span><span style="font-style:italic">-</span><span style="font-style:italic">data</span><span style="font-style:italic">-</span><span style="font-style:italic">mongodb </span><span style="font-style:italic">--&gt;</span>
<span style="font-weight:bold">&lt;dependency</span><span style="font-weight:bold">&gt;</span>
    <span style="font-weight:bold">&lt;groupId</span><span style="font-weight:bold">&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
    <span style="font-weight:bold">&lt;artifactId</span><span style="font-weight:bold">&gt;</span>spring-boot-starter-data-mongodb<span style="font-weight:bold">&lt;/artifactId&gt;</span>
    <span style="font-weight:bold">&lt;version</span><span style="font-weight:bold">&gt;</span>x.x.x.RELEASE<span style="font-weight:bold">&lt;/version&gt;</span>
<span style="font-weight:bold">&lt;/dependency&gt;</span>
</code></pre></div></li>
</ol>
<p>æ‰€ä»¥ï¼Œå½“è¦ä½¿ç”¨mongodbæ—¶ï¼Œå¼•å…¥<code>spring-boot-starter-data-mongodb</code>å³å¯ï¼Œå¦‚æœéœ€è¦ç”¨åˆ°å†…å­˜å¼mongoï¼Œåˆ™åœ¨æ­¤åŸºç¡€ä¸Šå†å¼•å…¥<code>de.flapdoodle.embed.mongo</code>å³å¯ã€‚AutoConfigurationå°±æ˜¯è¿™ä¹ˆå¼ï¼Œä»–èƒ½æ ¹æ®ä½ å¼•å…¥çš„åŒ…æ¥è‡ªåŠ¨é…ç½®å¯¹åº”çš„beanã€‚</p>
<p>é¦–å…ˆï¼Œå†…å­˜å¼mongoçš„è‡ªåŠ¨é…ç½®ç±»æ¡ä»¶ï¼š</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Configuration
@EnableConfigurationProperties({ MongoProperties.class, EmbeddedMongoProperties.class })
@AutoConfigureBefore(MongoAutoConfiguration.class)
@ConditionalOnClass({ MongoClient.class, MongodStarter.class })
<span style="font-weight:bold">public</span> <span style="font-weight:bold">class</span> <span style="font-weight:bold">EmbeddedMongoAutoConfiguration</span> {}
</code></pre></div><p>è¯¥é…ç½®æ—©äº<code>MongoAutoConfiguration</code>é…ç½®ï¼š</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Configuration
@ConditionalOnClass(MongoClient.class)
@EnableConfigurationProperties(MongoProperties.class)
@ConditionalOnMissingBean(type = <span style="font-style:italic">&#34;org.springframework.data.mongodb.MongoDbFactory&#34;</span>)
<span style="font-weight:bold">public</span> <span style="font-weight:bold">class</span> <span style="font-weight:bold">MongoAutoConfiguration</span> {}
</code></pre></div><p><code>MongoAutoConfiguration</code>é…ç½®ä»…å½“å®¹å™¨å†…ç¼ºå°‘<code>MongoDbFactory</code> beanæ—¶æ‰ä¼šç”Ÿæ•ˆã€‚</p>
<p>æœ€åï¼Œ<code>MongoDataAutoConfiguration</code>ä¼šå®ŒæˆSpring Data for Mongoçš„æ”¯æŒï¼Œè¿™æ ·ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ç›´æ¥æ³¨å…¥å¯¹åº”çš„beanå³å¯ã€‚è¯¥é…ç½®æä¾›<code>MongoTemplate</code>, <code>GridFsTemplate</code> ç”¨äºå­˜å‚¨å°æ–‡æ¡£å’Œå¤§æ–‡æ¡£ã€‚</p>
<p>å¯¹Mongoé…ç½®é¡¹æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥ç›´æ¥æŸ¥çœ‹<code>MongoProperties</code>é…ç½®ç±»</p>
<p>è‡³æ­¤ï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯æŠ›å‡ºï¼Œå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨mongoäº†~</p>
<h3 id="quartz-to-do">Quartz <em>[to do]</em></h3>
<p>å®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼Œèµ·æ­¥ä¾èµ–ï¼š</p>
<h3 id="kafka">Kafka</h3>
<p>Springæä¾›çš„å¯¹Kafkaå®¢æˆ·ç«¯çš„å°è£…ï¼Œèµ·æ­¥ä¾èµ–ï¼š</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="font-weight:bold">&lt;dependency</span><span style="font-weight:bold">&gt;</span>
	  <span style="font-weight:bold">&lt;groupId</span><span style="font-weight:bold">&gt;</span>org.springframework.kafka<span style="font-weight:bold">&lt;/groupId&gt;</span>
    <span style="font-weight:bold">&lt;artifactId</span><span style="font-weight:bold">&gt;</span>spring-kafka<span style="font-weight:bold">&lt;/artifactId&gt;</span>
<span style="font-weight:bold">&lt;/dependency&gt;</span>
</code></pre></div><p>è‡ªåŠ¨é…ç½®ç›¸å…³ç±»</p>
<ul>
<li><code>KafkaAutoConfiguration</code></li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Configuration
@ConditionalOnClass(KafkaTemplate.class)
@EnableConfigurationProperties(KafkaProperties.class)
@Import({ KafkaAnnotationDrivenConfiguration.class, KafkaStreamsAnnotationDrivenConfiguration.class })
<span style="font-weight:bold">public</span> <span style="font-weight:bold">class</span> <span style="font-weight:bold">KafkaAutoConfiguration</span> {}
</code></pre></div><p><code>KafkaTemplate</code>ç”±spring-kafkaåŒ…å¼•å…¥ã€‚åŒæ—¶å®Œæˆè‡ªåŠ¨é…ç½®åï¼Œè¿˜ä¼šå¼•å…¥<code>KafkaAnnotationDrivenConfiguration</code>å’Œ<code>KafkaStreamsAnnotationDrivenConfiguration</code> ä¸¤ä¸ªé…ç½®ï¼Œå‰è€…ä¸»è¦ç”¨æ¥æ”¯æŒspring-kafkaæä¾›çš„ç›¸å…³æ³¨è§£ï¼Œåè€…å’ŒKafka Streamç›¸å…³ï¼Œä¸åšè®¨è®ºï¼Œå®é™…ä¸Šèµ·æ­¥ä¾èµ–ä¸­ä¹Ÿä¸ä¼šåŒ…å«Kafka-Streamç›¸å…³çš„ä¸œè¥¿ï¼Œæ‰€ä»¥åè€…å¹¶ä¸ä¼šç”Ÿæ•ˆã€‚</p>
<p>è‡ªåŠ¨é…ç½®æä¾›çš„æœ€é‡è¦çš„beanå°±æ˜¯<code>KafkaTemplate</code>äº†ï¼Œé€šè¿‡è¯¥ç±»æä¾›çš„æ–¹æ³•ï¼Œå¯ä»¥å®Œæˆkafkaæ¶ˆæ¯çš„å‘é€ã€‚</p>
<p>åŒæ—¶spring-kafka-testæä¾›äº†å†…å­˜å¼çš„kafkaæ¥è¿›è¡Œæµ‹è¯•ï¼Œåªéœ€è¦å¼•å…¥ä¾èµ–ï¼š</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="font-weight:bold">&lt;dependency</span><span style="font-weight:bold">&gt;</span>
    <span style="font-weight:bold">&lt;groupId</span><span style="font-weight:bold">&gt;</span>org.springframework.kafka<span style="font-weight:bold">&lt;/groupId&gt;</span>
    <span style="font-weight:bold">&lt;artifactId</span><span style="font-weight:bold">&gt;</span>spring-kafka-test<span style="font-weight:bold">&lt;/artifactId&gt;</span>
<span style="font-weight:bold">&lt;/dependency&gt;</span>
</code></pre></div><ul>
<li>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="font-weight:bold">spring</span>:  
  <span style="font-weight:bold">kafka</span>:
    <span style="font-weight:bold">bootstrap-servers</span>: ${spring.embedded.kafka.brokers}
    <span style="font-weight:bold">consumer</span>:
      <span style="font-weight:bold">group-id</span>: honeyroom
</code></pre></div><ul>
<li>æµ‹è¯•ç¤ºä¾‹ï¼ˆæ¶ˆè´¹è€…ï¼‰ï¼š</li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Slf4j
@Component
<span style="font-weight:bold">public</span> <span style="font-weight:bold">class</span> <span style="font-weight:bold">DemoConsumer</span> {

    @KafkaListener(topics = <span style="font-style:italic">&#34;test-consumer&#34;</span>)
    <span style="font-weight:bold">public</span> <span style="">void</span> handle(String message) {
        log.info(<span style="font-style:italic">&#34;receive message: {}&#34;</span>, message);
        System.out.println(<span style="font-style:italic">&#34;========== kafka message ===========&#34;</span>);
        System.out.println(message);
    }
}
</code></pre></div><p>å…¶ä¸­ï¼Œ<code>DemoMessage</code>ç»“æ„ä¸ºï¼š</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Data
<span style="font-weight:bold">public</span> <span style="font-weight:bold">class</span> <span style="font-weight:bold">DemoMessage</span> {
    <span style="font-weight:bold">private</span> String key;
    <span style="font-weight:bold">private</span> String value;
    <span style="font-weight:bold">private</span> DateTime timestamp; <span style="font-style:italic">//joda time
</span><span style="font-style:italic"></span>}
</code></pre></div><ul>
<li>æµ‹è¯•ç¤ºä¾‹ï¼ˆç”Ÿäº§è€…ï¼‰ï¼š</li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@RunWith(SpringRunner.class)
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
<span style="font-weight:bold">public</span> <span style="font-weight:bold">class</span> <span style="font-weight:bold">KafkaTests</span> {
    @ClassRule
    <span style="font-weight:bold">public</span> <span style="font-weight:bold">static</span> EmbeddedKafkaRule embeddedKafka = <span style="font-weight:bold">new</span> EmbeddedKafkaRule(1, <span style="font-weight:bold">false</span>, 5).kafkaPorts(9092);

    @Autowired
    <span style="font-weight:bold">private</span> KafkaTemplate&lt;String, String&gt; kafkaTemplate;

    @Autowired
    ObjectMapper objectMapper;

    @Test
    <span style="font-weight:bold">public</span> <span style="">void</span> testKafka() <span style="font-weight:bold">throws</span> Exception {
        DemoMessage message = <span style="font-weight:bold">new</span> DemoMessage();
        message.setKey(<span style="font-style:italic">&#34;key&#34;</span>);
        message.setValue(<span style="font-style:italic">&#34;value&#34;</span>);
        message.setTimestamp(DateTime.now());
        kafkaTemplate.send(<span style="font-style:italic">&#34;test.consumer&#34;</span>, objectMapper.writeValueAsString(message));
        Thread.sleep(1000000);
    }
}
</code></pre></div><p>é€šè¿‡åœ¨æœ¬åœ°æ‰§è¡Œè„šæœ¬ç›‘å¬ï¼Œå¯ä»¥çœ‹åˆ°æµ‹è¯•å‘å‡ºçš„kafkaæ¶ˆæ¯ã€‚</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test.consumer --from-beginning
</code></pre></div><p>kafka shellæ–‡ä»¶åœ¨<a href="http://mirrors.tuna.tsinghua.edu.cn/apache/kafka/2.3.1/kafka_2.11-2.3.1.tgz">Kafka binary package</a> çš„binç›®å½•ä¸‹ã€‚</p>
<h3 id="redis">Redis</h3>
<p>springæä¾›çš„Rediså®¢æˆ·ç«¯çš„å°è£…ï¼Œèµ·æ­¥ä¾èµ–ï¼š</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="font-weight:bold">&lt;dependency</span><span style="font-weight:bold">&gt;</span>
     <span style="font-weight:bold">&lt;groupId</span><span style="font-weight:bold">&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
     <span style="font-weight:bold">&lt;artifactId</span><span style="font-weight:bold">&gt;</span>spring-boot-starter-data-redis<span style="font-weight:bold">&lt;/artifactId&gt;</span>
<span style="font-weight:bold">&lt;/dependency&gt;</span>
</code></pre></div><p>è‡ªåŠ¨é…ç½®ç±»<code>RedisAutoConfiguration</code>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Configuration
@ConditionalOnClass(RedisOperations.class)
@EnableConfigurationProperties(RedisProperties.class)
@Import({ LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class })
<span style="font-weight:bold">public</span> <span style="font-weight:bold">class</span> <span style="font-weight:bold">RedisAutoConfiguration</span> {}
</code></pre></div><p>ç†Ÿæ‚‰çš„é…æ–¹ï¼Œç†Ÿæ‚‰çš„å¥—è·¯ï¼Œå¼•å…¥èµ·æ­¥ä¾èµ–åèƒ½æ»¡è¶³<code>@ConditionalOnClass(RedisOperations.class)</code>æ¡ä»¶ï¼Œç„¶åé…ç½®æ–‡ä»¶è·å–<code>RedisProperties.class</code>çš„é…ç½®ï¼Œæœ€åå†å¯¼å…¥<code>LettuceConnectionConfiguration.class</code> æˆ–è€… <code>JedisConnectionConfiguration.class</code>ï¼Œè¿™ä¿©éƒ½æ˜¯ä¸€ä¸ªåŠŸèƒ½ï¼Œå°±æ˜¯æä¾›<code>RedisTemplate</code>æ‰€ä¾èµ–çš„beanï¼Œæ¯”å¦‚ <code>RedisConnectionFactory.class</code>ï¼Œé»˜è®¤<code>LettuceConnectionConfiguration.class</code>ç”Ÿæ•ˆã€‚</p>
<h4 id="è¿è¡ŒåŸºäºdockerçš„redis">è¿è¡ŒåŸºäºDockerçš„Redis</h4>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="font-style:italic">#1. è·å–é•œåƒ</span>
docker pull redis

<span style="font-style:italic">#2. è¿è¡Œé•œåƒ</span>
docker run -p 6379:6379 -d redis:latest redis-server --requirepass <span style="font-style:italic">&#34;123456&#34;</span>

<span style="font-style:italic">#3. è¿›å…¥å®¹å™¨å†…çš„Rediså‘½ä»¤è¡Œç•Œé¢</span>
docker exec -ti 1729cb4a78c4 redis-cli

<span style="font-style:italic">#4. è¿›å…¥åè¿›è¡Œé‰´æƒ</span>
auth 123456
</code></pre></div><ul>
<li><code>-p</code> æ˜ å°„å®¹å™¨ç«¯å£åˆ°ä¸»æœºç«¯å£</li>
<li><code>-d</code> åå°è¿è¡Œå®¹å™¨å¹¶æ‰“å°å®¹å™¨ID</li>
<li><code>redis:latest</code> docker é•œåƒ</li>
<li><code>redis-server --requirepass &quot;123456&quot;</code> å®¹å™¨å†…å‘½ä»¤</li>
</ul>
<p>è‡ªåŠ¨é…ç½®ç”Ÿæˆçš„<code>StringRedisTemplate</code> ã€‚æ…ç”¨ï¼Œå¦‚æœé¡¹ç›®åå‘äºç”¨jsonï¼Œè€Œä¸”é¡¹ç›®ç”¨åˆ°äº†spring mvcï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•é…ç½®ï¼š</p>
<ul>
<li>
<p>Jacksonä¸­ï¼Œå¯¹äºjoda timeçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–è‡ªå®šä¹‰æ–¹æ³•</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@JsonComponent
<span style="font-weight:bold">public</span> <span style="font-weight:bold">class</span> <span style="font-weight:bold">DateTimeComponent</span> {
    <span style="font-weight:bold">public</span> <span style="font-weight:bold">static</span> <span style="font-weight:bold">final</span> String DEFAULT_DATETIME_FORMATTER = <span style="font-style:italic">&#34;yyyy-MM-dd&#39;T&#39;hh:mm:ss&#39;Z&#39;&#34;</span>;
  
    <span style="font-weight:bold">public</span> <span style="font-weight:bold">static</span> <span style="font-weight:bold">class</span> <span style="font-weight:bold">SomeDTOSerializer</span> <span style="font-weight:bold">extends</span> JsonSerializer&lt;DateTime&gt; {
        @Override
        <span style="font-weight:bold">public</span> <span style="">void</span> serialize(DateTime value, JsonGenerator gen, SerializerProvider serializers) <span style="font-weight:bold">throws</span> IOException {
            gen.writeString(value.toString(DEFAULT_DATETIME_FORMATTER));
        }
    }
  
    <span style="font-weight:bold">public</span> <span style="font-weight:bold">static</span> <span style="font-weight:bold">class</span> <span style="font-weight:bold">SomeDTODeserializer</span> <span style="font-weight:bold">extends</span> JsonDeserializer&lt;DateTime&gt; {
        @Override
        <span style="font-weight:bold">public</span> DateTime deserialize(JsonParser p, DeserializationContext ctxt) <span style="font-weight:bold">throws</span> IOException, JsonProcessingException {
            <span style="font-weight:bold">return</span> DateTime.parse(p.getValueAsString(), DateTimeFormat.forPattern(DEFAULT_DATETIME_FORMATTER));
        }
    }
}
</code></pre></div><p>è¯·æ³¨æ„ï¼Œæ­¤æ—¶å®é™…ä¸Šæ˜¯å¯¹spring mvcä¸­çš„Jacksonåšäº†é…ç½®ï¼Œå¦‚éœ€è¿ç”¨åœ¨Redisä¸­ï¼Œè¿˜éœ€è¦ä»¥ä¸‹é…ç½®ï¼š</p>
</li>
<li>
<p>RedisConfig</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Configuration
@AllArgsConstructor
<span style="font-weight:bold">public</span> <span style="font-weight:bold">class</span> <span style="font-weight:bold">RedisConfig</span> {
    <span style="font-weight:bold">private</span> ObjectMapper objectMapper; <span style="font-style:italic">//ç±»æ„é€ å™¨æ³¨å…¥
</span><span style="font-style:italic"></span>  
    @Autowired
    <span style="font-weight:bold">public</span> <span style="">void</span> jsonRedisTemplate(RedisTemplate redisTemplate) {
        redisTemplate.setKeySerializer(RedisSerializer.string());
        <span style="font-style:italic">// ä½¿ç”¨å’ŒMVCçš„JacksonåŒä¸€ä¸ªè½¬æ¢å™¨ï¼Œmvcçš„jacksonè½¬æ¢å™¨æ¯”è¾ƒæ–¹ä¾¿å®šä¹‰ç‰¹æ®Šç±»å‹çš„è½¬æ¢ï¼Œæ¯”å¦‚joda time
</span><span style="font-style:italic"></span>        redisTemplate.setValueSerializer(<span style="font-weight:bold">new</span> GenericJackson2JsonRedisSerializer(objectMapper));
        redisTemplate.setHashKeySerializer(RedisSerializer.string());
        redisTemplate.setHashValueSerializer(<span style="font-weight:bold">new</span> GenericJackson2JsonRedisSerializer(objectMapper));
    }
}
</code></pre></div></li>
<li>
<p>å’Œå…¶ä»–templateä¸€æ ·ï¼Œä½¿ç”¨ä¸Šç›¸å½“ç®€å•ï¼š</p>
</li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Slf4j
@Service
@AllArgsConstructor
<span style="font-weight:bold">public</span> <span style="font-weight:bold">class</span> <span style="font-weight:bold">RedisService</span> {
    <span style="font-weight:bold">private</span> RedisTemplate&lt;Object, Object&gt; redisTemplate;
    <span style="font-weight:bold">private</span> ObjectMapper objectMapper;
    <span style="font-weight:bold">private</span> <span style="font-weight:bold">static</span> <span style="font-weight:bold">final</span> <span style="">int</span> DEFAULT_EXPIRE_INTERVAL = 300;
    <span style="font-weight:bold">private</span> <span style="font-weight:bold">static</span> <span style="font-weight:bold">final</span> TimeUnit DEFAULT_TIME_UNIT = TimeUnit.SECONDS;

    <span style="font-weight:bold">public</span> <span style="">boolean</span> save(String key, Object value) {
        <span style="font-weight:bold">try</span> {
            redisTemplate.opsForValue().set(key, value);
            redisTemplate.expire(key, DEFAULT_EXPIRE_INTERVAL, DEFAULT_TIME_UNIT);
            <span style="font-weight:bold">return</span> <span style="font-weight:bold">true</span>;
        } <span style="font-weight:bold">catch</span> (Exception e) {
            log.error(<span style="font-style:italic">&#34;can&#39;t cache data, {}&#34;</span>, e.getMessage());
            <span style="font-weight:bold">return</span> <span style="font-weight:bold">false</span>;
        }
    }

    <span style="font-weight:bold">public</span> &lt;T&gt; T get(String key, Class&lt;T&gt; clazz) {
        <span style="font-weight:bold">try</span> {
            Object value = redisTemplate.opsForValue().get(key);
            <span style="font-weight:bold">return</span> objectMapper.convertValue(value, clazz);
        } <span style="font-weight:bold">catch</span> (Exception e) {
            log.error(<span style="font-style:italic">&#34;can&#39;t get cached data, {}&#34;</span>, e.getMessage());
            <span style="font-weight:bold">return</span> <span style="font-weight:bold">null</span>;
        }
    }
}
</code></pre></div><p>å†™ä¸ªLLTè°ƒç”¨ä¸€ä¸‹ï¼š</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@RunWith(SpringRunner.class)
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
<span style="font-weight:bold">public</span> <span style="font-weight:bold">class</span> <span style="font-weight:bold">RedisTest</span> {
    @Autowired
    RedisService redisService;

    @Autowired
    ObjectMapper objectMapper;

    @Test
    <span style="font-weight:bold">public</span> <span style="">void</span> testSave() <span style="font-weight:bold">throws</span> Exception {
        DemoMessage message = <span style="font-weight:bold">new</span> DemoMessage();
        message.setKey(<span style="font-style:italic">&#34;key&#34;</span>);
        message.setValue(<span style="font-style:italic">&#34;value&#34;</span>);
        message.setTimestamp(DateTime.now());
        redisService.save(<span style="font-style:italic">&#34;test&#34;</span>, message);
    }

    @Test
    <span style="font-weight:bold">public</span> <span style="">void</span> testGet() <span style="font-weight:bold">throws</span> Exception {
        DemoMessage demoMessage = redisService.get(<span style="font-style:italic">&#34;test&#34;</span>, DemoMessage.class);
        System.out.println(<span style="font-style:italic">&#34;====demomessage===: {}&#34;</span> + demoMessage.toString());
        Assert.notNull(demoMessage);
        Assert.isTrue(<span style="font-style:italic">&#34;key&#34;</span>.equals(demoMessage.getKey()));
        Assert.isTrue(<span style="font-style:italic">&#34;value&#34;</span>.equals(demoMessage.getValue()));
        Assert.notNull(demoMessage.getTimestamp());
    }
}
</code></pre></div><h4 id="why-">WHY ?</h4>
<ul>
<li>
<p>ä¸ºä»€ä¹ˆè¦ç”¨<code>@JsonComponent</code>æ³¨è§£ï¼Œä¸ºä»€ä¹ˆè¦ç”¨å’Œhttpæ¶ˆæ¯è§£æç›¸åŒçš„<code>ObjectMapper</code>ï¼Œä¸ºä»€ä¹ˆå»ºè®®æ•´ä¸ªé¡¹ç›®ç”¨åŒä¸€ä¸ª<code>ObjectMapper</code>ï¼Ÿ</p>
<p>ä¸ªäººè§‰å¾—ï¼Œè¿™æ˜¯å‡å°‘å†—ä½™ä»£ç çš„æœ€ä½³æ–¹æ¡ˆï¼Œä½¿ç”¨springbootæä¾›çš„æ³¨è§£è‡ªå®šä¹‰åºåˆ—åŒ–ååºåˆ—åŒ–æ–¹æ³•ï¼Œèƒ½å°†ä»£ç é‡é™åˆ°æœ€ä½ï¼Œè®©å¼€å‘å¤æ‚åº¦é™åˆ°æœ€ä½ã€‚åœ¨Rediså’ŒHttpä¸­ä½¿ç”¨åŒä¸€ä¸ª<code>ObjectMapper</code>ï¼Œèƒ½å¤Ÿç»Ÿä¸€é¡¹ç›®å†…éƒ¨ä¸é¡¹ç›®å¤–éƒ¨ä¹‹é—´çš„æ•°æ®è½¬æ¢è¡Œä¸ºï¼ŒåŒæ—¶è¿˜èƒ½å°†ä»£ç é‡é™åˆ°æœ€ä½ã€‚å½“ç„¶å¦‚æœæœ‰ç‰¹æ®Šæƒ…å†µï¼ˆæ¯”å¦‚æˆ‘éœ€è¦Httpçš„æ—¶å€™DateTimeè½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œè€Œå­˜Redisçš„æ—¶å€™è½¬æ¢æˆæ—¶é—´æˆ³ï¼‰ï¼Œå½“ç„¶å¯ä»¥ä¸ä½¿ç”¨åŒä¸€ä¸ª<code>ObjectMapper</code>ã€‚</p>
<p>å¦‚æœä¸€ä¸ªé¡¹ç›®ä¸­å……æ–¥ç€<code>new ObjectMapper()</code>ï¼Œç»å¯¹æ˜¯ç¾éš¾ï¼Œå› ä¸ºä½ æ— æ³•ä¸ºç‰¹æ®Šç±»å‹ç»Ÿä¸€è¡Œä¸ºï¼Œä¸€æ—¦éœ€è¦è‡ªå®šä¹‰ç‰¹æ®Šç±»å‹çš„è½¬æ¢ï¼Œæ•ˆç‡å°†æå…¶ä½ä¸‹ï¼Œä½•ä¸å°†è¿™äº›æ—¶é—´èŠ±åœ¨ä¼˜åŒ–ç»“æ„ä¸Šï¼Œè€Œä¸æ˜¯å»åšé‚£äº›æ¯«æ— æ„ä¹‰çš„é‡å¤åŠ³åŠ¨ã€‚</p>
</li>
<li>
<p>ä¸ºä»€ä¹ˆè¦åšä¸€ä¸ªä¸­é—´å±‚<code>RedisService</code>ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨ä¸šåŠ¡ä¸­<code>@Autowired RedisTemplate</code>ï¼Ÿ</p>
<p>å¥½å¤„æ˜¾è€Œæ˜“è§ï¼Œå°±çŠ¹å¦‚webå¼€å‘å®šä¹‰çš„Controllerå±‚ï¼ŒServiceå±‚ï¼ŒDAOå±‚ç±»ä¼¼ï¼Œåœ¨Controllerå±‚å®šä¹‰æ¥å£ï¼Œæ•°æ®æ ¡éªŒç­‰ï¼›åœ¨Serviceå±‚åšäº‹åŠ¡å¤„ç†ç­‰ï¼Œåœ¨DAOå±‚è®¿é—®æ•°æ®ã€‚<code>RedisService</code>çš„ä½œç”¨ç±»ä¼¼ï¼Œâ€œæ‰¿ä¸Šå¯ä¸‹â€-å¯¹ä¸Šæä¾›é¢å‘ä¸šåŠ¡çš„æ¥å£ï¼Œå¯¹ä¸‹æ¥å¤„ç†ä¸€äº›é€šç”¨çš„å…¬å…±çš„â€œçäº‹â€ï¼Œæ¯”å¦‚è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚é€šè¿‡è¿™ç§åˆ†å±‚ï¼Œèƒ½è®©ä»£ç é€»è¾‘æ›´åŠ æ¸…æ™°ï¼Œå¯è¯»æ€§ï¼Œå¯ç»´æŠ¤æ€§éƒ½å˜å¾—æ›´å¥½ã€‚ç¼–ç¨‹æ˜¯ä¸€é¡¹ç¤¾ä¼šæ´»åŠ¨ï¼Œå†™å‡ºçš„ä»£ç å°±å¦‚åŒä½ è¯´å‡ºæ¥çš„è¯ä¸€æ ·ï¼ŒåŠä½ å¥½å¥½è¯´è¯ã€‚</p>
<p><strong>Redisä¸€å®šè¦è®¾ç½®è¿‡æœŸæ—¶é—´</strong>ï¼Œå¦åˆ™è¿Ÿæ—©å‡ºäº‹æ•…ã€‚</p>
</li>
</ul>
<h2 id="spring-integration">Spring Integration</h2>
<h3 id="æ¦‚è§ˆ">æ¦‚è§ˆ</h3>
<ul>
<li>spring integration <a href="https://docs.spring.io/spring-integration/docs/5.2.1.RELEASE/reference/html/overview.html#overview-components">overview</a></li>
</ul>

      </div>


      <footer>
        


        <div id="vssue"></div>
    <link rel="stylesheet" href="https://unpkg.com/vssue/dist/vssue.min.css">
    <script src="https://unpkg.com/vue/dist/vue.runtime.min.js"></script>
    <script src="https://unpkg.com/vssue/dist/vssue.github.min.js"></script>
    <script>
    new Vue({
      el: '#vssue',

      render: h => h('Vssue', {
        props: {
          
          title: options => `${options.prefix}:${document.url}`

          
          options: {
            owner: 'XIEJD',
            repo: 'xiejd.github.io',
            clientId: 'd49c970afdb5dc4631f9',
            clientSecret: '200eadf0eaf8388c460170701a3af5155208133d', 
          },
        }
      })
    })
    </script>

        
        
      </footer>
    </article>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script type="text/javascript" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js" id="MathJax-script"></script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [
          ['$', '$'], ['\\(', '\\)']
        ],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
  </script>
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
      <p>æµ“ä¸åˆ©ç”Ÿè´ªï¼Œæµ“äºåç”Ÿå—”ï¼Œæµ“äºæƒ…ç”Ÿç—´ã€‚</p>
    
    
      
        Â© 2020
      
       Shareif 
    
    
       Â· 
      Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
